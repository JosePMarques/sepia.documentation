.. _fmritoolkit2019-exercise2:

Exercise 2
==========

Objectives
----------

- Understanding why we need to remove the background magnetic field contributions before QSM  
- Fine-tuning method parameters to improve the background field removal results

One more step before computing QSM but why?
-------------------------------------------

In the previous exercise we need to adjust the display windowing in order to see some brain structures, but why are these tissue contrasts 'hidden' in our images?   

The short answer to this question is simply because the phase shift we measured is not local. This means that it contains not only the magnetic field generated by the brain tissues but also by the scanner hardware imperfection and air/tissue interface such as sinuses. These non-tissue fields, or so-called background fields, can be one or two order of magnitude strong than the tissue field and affects all the brain tissues. Since we are only interested in the magnetic field generated by the brain tissue, we have to remove these background fields before computing the QSM map. However, the background fields and tissue fields are co-existed across the whole brain, how can we distinguish which fields are coming from the tissues and which fields are coming from the background? Luckily, the background fields have different mathematical properties. Researchers have successfully developed some algorithms to separate the tissue fields and background fields. 

Background Field Removal  
------------------------

SEPIA provides 7 methods to remove the background magnetic fields. Today we will try the Laplacian boundary values (LBV) algorithm. Go to the **Background field removal** tab. You will see two panels as the **Phase unwrapping** tab. 

First, in the **I/O** panel, specify the **Total field** image (output/Sepia_total-field.nii.gz), **Header** file (Sepia_header.mat) and **Brain mask** (output/Sepia_mask.nii.gz) by using the **open** buttons.  

Second, in the **Background field removal** panel, the 'LBV' method is shown by default. You have three parameters to adjust the output. 'Tolerance' is the threshold to stop the algorithm. 'Depth'. 'Peel' is the layer of boundary voxels to be removed after computing the tissue (or so-called local) fields. In this exercise, we will focus on the differences using different 'Peel' values. Right now, just leave these parameters as they are and press the **Start** button. Again, you will see the message ``Done!`` when the process is finished. Try to change the 'Peel' value to '4'. Use FSLeyes to display both output images at the same time. What is the main difference between the two results?

     