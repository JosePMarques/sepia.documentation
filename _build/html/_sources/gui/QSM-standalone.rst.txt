QSM Standalone
==============

How can we map the magnetic susceptibility sources from local field map?
------------------------------------------------------------------------

A local field (or tissue field) is the field generated by the magnetic susceptibility sources from the brain tissue. The assumption of the field generated by a magnetic susceptibility point source is a dipole field. We can then try to compute the susceptibility values by deconvolving the local field with a dipole field. However, due to the fact that the dipole field in the k-space (i.e. the dipole kernel) has zero values on the cone surface at 54.7Â° and values close to this surface will also be close to zeros. As a result, the number of unknown parameters is more than the measurements we have in the data, leading to the problem ill-conditioned and the resulting QSM map has the so-called streaking artefact. To solve the ill-conditioned problem, most of the QSM algorithms try to add a regularisation term in the QMS dipole inversion problem, imposing spatial smoothness in the QSM map and/or the QSM map has similar anatomical features as shown in the magnitude images in order to reduce the streaking artefact in the QSM result.

Structure of the application
----------------------------

This standalone consists of two panels:

- I/O panel, and
- QSM panel.

The detailed description of each panel is given below:

I/O panel
^^^^^^^^^

.. image:: images/qsm_io.png

- Data input

  This application accepts two types of data input method:

  1. Specify a directory that contains all NIfTI images. Please specify the names of your data as in the following:

     - **Local field data**: must contain the string 'local-field' in the filename, e.g. *local-field.nii.gz*;
     - **Header**: must contain the string 'header' in the filename, e.g. *header.mat*;
     - **Magnitude data**: must contain the string 'magn' in the filename, e.g. *magn.nii.gz*;
     - (optional) **Fieldmap standard deviation data**: must contain the string 'fieldmap-sd' in the filename, e.g. *fieldmap-sd.nii.gz*;
     - (optional) **Mask data**: if provided, must contain string 'mask' in the filename, e.g. *mask.nii.gz*, or

  2. Specify the required data separately using the GUI buttons. 

- Data output

  You can specify the prefix of the data output name in the editable field 'Output basename'. By default, the Sepia output will be stored in a directory named 'output' under the input directory, i.e. '/your/input/directory/output/' with prefix 'squirrel'. You can change the default output directory and basename to whatever you need. If the output directory does not exist, the application will create the directory. 

QSM panel
^^^^^^^^^

.. image:: images/qsm_qsm.png

- Method:

  1. `TKD <https://doi.org/10.1002/mrm.22334>`_  

    Thresholded k-space division

  2. `Closed-form solution <https://doi.org/10.1002/jmri.24365>`_  

    closed-form solution with L2-norm regularisation

  3. `STI suite iLSQR <https://doi.org/10.1016/j.neuroimage.2010.11.088>`_  

    STI suite v3.0 implementation of iterative LSQR approach

  4. `iLSQR <https://doi.org/10.1016/j.neuroimage.2010.11.088>`_


  5. `FANSI <https://doi.org/10.1002/mrm.27073>`_  

    Fast algorithm for nonlinear susceptibility inversion

  6. `Star <https://doi.org/10.1002/nbm.3383>`_  

    STI suite v3.0 Star-QSM  

  7. `MEDI <https://doi.org/10.1002/mrm.26946>`_  

    Morphology enabled dipole inversion (MEDI+0)   

- Output     

  The output of the standalone application is given below:
  
  - *QSM.nii.gz* (quantitative susceptibility map, in ppm)  