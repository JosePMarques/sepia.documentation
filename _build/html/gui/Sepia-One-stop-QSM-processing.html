
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SEPIA (One-stop QSM processing) &#8212; SEPIA 0.7 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Phase Unwarpping Standalone" href="Phase-unwrapping-standalone.html" />
    <link rel="prev" title="SEPIA header" href="../getting_started/Sepia-header.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Phase-unwrapping-standalone.html" title="Phase Unwarpping Standalone"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../getting_started/Sepia-header.html" title="SEPIA header"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SEPIA 0.7 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sepia-one-stop-qsm-processing">
<h1>SEPIA (One-stop QSM processing)<a class="headerlink" href="#sepia-one-stop-qsm-processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-sepia">
<h2>What is SEPIA?<a class="headerlink" href="#what-is-sepia" title="Permalink to this headline">¶</a></h2>
<p>SEPIA is a pipeline analysis tool for quantitative susceptibility mapping (QSM) in Brain Imaging. It provides all the essential functions people would need to compute a susceptibility map from a 3D multi-echo GRE phase data, including phase unwrapping, background field contribution removal and dipole inversion. Incorporate with different toolboxes in SEPIA giving users the advantages of having a variety of options to build a pipeline that works the best for their data. When you use the SEPIA graphical user interface to process the data, a log file will be generated that contains also the setting and command that you’ve chosen in the pipeline. This log file will be particularly useful for batch processing.</p>
</div>
<div class="section" id="structure-of-the-application">
<h2>Structure of the application<a class="headerlink" href="#structure-of-the-application" title="Permalink to this headline">¶</a></h2>
<p>This standalone consists of 4 panels:</p>
<ul class="simple">
<li>Input/Output(I/O) panel,</li>
<li>Total field recovery and phase unwrapping panel,</li>
<li>Background field removal panel, and</li>
<li>QSM panel.</li>
</ul>
<p>The detailed description of each panel is given below:</p>
<div class="section" id="i-o-panel">
<h3>I/O panel<a class="headerlink" href="#i-o-panel" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Data input</p>
<p>This application accepts three types of data input method:</p>
<ol class="arabic simple">
<li>Specify a directory that contains all NIfTI images. Please specify the names of your data as in the following:<ul>
<li><strong>Phase</strong>: must contain the string ‘ph’ in the filename, e.g. <em>phase.nii.gz</em>;</li>
<li><strong>Magnitude</strong>: must contain the string ‘mag’ in the filename, e.g. <em>magn.nii.gz</em>;</li>
<li><strong>Header</strong>: must contain the string ‘header’ in the filename, e.g. <em>header.mat</em>;</li>
<li>(optional) <strong>Mask data</strong>: if provided, must contain string ‘mask’ in the filename, e.g. <em>mask.nii.gz</em>, or</li>
</ul>
</li>
<li>Specify the required data separately using the GUI buttons.</li>
</ol>
</li>
<li><p class="first">Data output</p>
<p>You can specify the prefix of the data output name in the editable field ‘Output basename’. By default, the SEPIA output will be stored in a directory named ‘<em>output</em>’ under the input directory, i.e. ‘_/your/input/directory/output/_’ with prefix ‘<em>sepia</em>’. You can change the default output directory and basename to whatever you need. If the output directory does not exist, the application will create the directory.</p>
</li>
<li><p class="first">Brain mask</p>
<p>QSM-related algorithms often require a mask that contains only brain tissue. If you already have the brain mask data in NIfTI format, you can select the file manually, or named it with a specific name (see <strong>Data input</strong> section) and put it in the directory with other NIfTI files. Alternatively, you can check the ‘<strong>FSL brain extraction</strong>’ checkbox to extract the brain mask. Enabling this option will run the Matlab implementation of FSL’s brain extraction tool (bet) implemented with MEDI toolbox.</p>
</li>
<li><p class="first">Invert phase data</p>
<p>Due to the way of how the phase data is stored, values of the final local field map and/or magnetic susceptibility map might be inverted, i.e. positive frequency shift and paramagnetic magnetic susceptibility will show in negative, and vice versa. If it is the case, you can invert the values of the results by checking the ‘<strong>Invert phase data</strong>’ option. This will apply a conjugate operation to the phase data after the data being loaded.</p>
</li>
</ul>
</div>
<div class="section" id="total-field-recovery-and-phase-unwrapping-panel">
<h3>Total field recovery and phase unwrapping panel<a class="headerlink" href="#total-field-recovery-and-phase-unwrapping-panel" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Echo phase combination</p>
<p>As the first step to process the multi-echo data, we need to recover the total frequency shift of the tissue across times. SEPIA provides two different ways to do this:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://doi.org/10.1002/nbm.3601">Optimum weights</a></li>
</ol>
<blockquote>
<div><p>This is a weighted combination of the phase difference between successive echoes, in which the weights are inversely proportional to the variance of the noise of the fieldmap estimated from the magnitude echo images.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><strong>MEDI nonlinear fit</strong></li>
</ol>
<blockquote>
<div><p>This is a method in the MEDI toolbox</p>
</div></blockquote>
</li>
<li><p class="first">Phase unwrapping</p>
<p>There are 5 phase unwrapping method supported in SEPIA</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">Laplacian</a></li>
</ol>
<blockquote>
<div><p>Laplacian unwrapping implementation in MEDI toolbox</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">Laplacian STI suite</a></li>
</ol>
<blockquote>
<div><p>Laplacian unwrapping implementation in STI Suite v3.0</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><a class="reference external" href="https://doi.org/10.1364/AO.46.006623">3D best path</a></li>
</ol>
<blockquote>
<div><p>Robust region growing method yet only works in the DCCN cluster (recommended if you use this toolbox in the DCCN cluster)</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><strong>Region growing</strong></li>
</ol>
<blockquote>
<div><p>Region growing method in the MEDI toolbox</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><a class="reference external" href="https://doi.org/10.1109/TMI.2014.2361764">Graphcut</a></li>
</ol>
<blockquote>
<div><p>Graph-cut algorithm in the MEDI toolbox, sometimes uses with water-fat imaging.</p>
</div></blockquote>
</li>
<li><p class="first">Bipolar readout eddy current correction:</p>
<p>enable to correct the phase inconsistency between odd and even echoes, and a gradient-like field contribution by eddy current effect due to bipolar readout.
If this option is enabled, the eddy current corrected data will be stored in the output directory with the following name:</p>
<ul class="simple">
<li><em>phase_eddy-correct.nii.gz</em> (eddy current corrected phase data)</li>
</ul>
</li>
<li><p class="first">Exclude unreliable voxels, Threshold:</p>
<p>enable to exclude low SNR voxels that can create strong artefacts in susceptibility map (you may check with ‘<em>relative-residual.nii.gz</em>’ to adjust the threshold). Voxels that have relative fitting residual greater than the threshold will be weighted with zero in subsequent processes. Only available for region growing and 3D best path unwrapping methods.</p>
</li>
<li><p class="first">Output</p>
<p>The output of this step are given below:</p>
<ul class="simple">
<li><em>total-field.nii.gz</em>        (unwrapped total (background+local) field, in Hz)</li>
<li><em>fieldmap-sd.nii.gz</em>        (normalised field map standard deviation)</li>
<li><em>mask.nii.gz</em> (FSL’s bet brain mask, optional)</li>
<li><em>mask-reliable.nii.gz</em> (thresholded brain mask, optional)</li>
<li><em>relative-residual.nii.gz</em> (relative residual of fitting a mono-exponential decay function with a single frequnecy shift, depends on unwrapping method)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="background-field-removal-panel">
<h3>Background field removal panel<a class="headerlink" href="#background-field-removal-panel" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Method</p>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/nbm.3064">LBV</a></p>
<p>Laplacian boundary value approach to removal background field</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/nbm.1670">PDF</a></p>
<p>Projection onto dipole field</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/mrm.24765">RESHARP</a></p>
<p>regularisation enabled SHARP</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.10.070">SHARP</a></p>
<p>Sophisticated harmonic artefact reduction for phase data</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">VSHARP STI suite</a></p>
<p>STI suite v3.0 variable-kernel SHARP</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">VSHARP</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/nbm.3056">iHARPERELLA</a></p>
<p>(not optimised with SEPIA yet)</p>
</li>
</ol>
</li>
<li><p class="first">Refine local field by 4th order 3D polynomial fit</p>
<p>Enable to remove residual B1(+ &amp; -) contribution in the local field</p>
</li>
<li><p class="first">Output</p>
<p>The output of this step are given below:</p>
<ul class="simple">
<li><em>local-field.nii.gz</em> (local (or tissue) field, in Hz)</li>
<li><em>mask-qsm.nii.gz</em> (brain mask where local field is reliable, might be eroded and depended on the background field removal algorithms and ‘<strong>exclude unreliable voxels</strong>’ threshold value)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="qsm-panel">
<h3>QSM panel<a class="headerlink" href="#qsm-panel" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Method:</p>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/mrm.22334">TKD</a></p>
<p>Thresholded k-space division</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/jmri.24365">Closed-form solution</a></p>
<p>closed-form solution with L2-norm regularisation</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">STI suite iLSQR</a></p>
<p>STI suite v3.0 implementation of iterative LSQR approach</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.11.088">iLSQR</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/mrm.27073">FANSI</a></p>
<p>Fast algorithm for nonlinear susceptibility inversion</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/nbm.3383">Star</a></p>
<p>STI suite v3.0 Star-QSM (recommended)</p>
</li>
<li><p class="first"><a class="reference external" href="https://doi.org/10.1002/mrm.26946">MEDI</a></p>
<p>Morphology enabled dipole inversion (MEDI+0)</p>
</li>
</ol>
</li>
<li><p class="first">Output</p>
<p>The output of this step is given below:</p>
<ul class="simple">
<li><em>QSM.nii.gz</em> (quantitative susceptibility map, in ppm)</li>
</ul>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SEPIA (One-stop QSM processing)</a><ul>
<li><a class="reference internal" href="#what-is-sepia">What is SEPIA?</a></li>
<li><a class="reference internal" href="#structure-of-the-application">Structure of the application</a><ul>
<li><a class="reference internal" href="#i-o-panel">I/O panel</a></li>
<li><a class="reference internal" href="#total-field-recovery-and-phase-unwrapping-panel">Total field recovery and phase unwrapping panel</a></li>
<li><a class="reference internal" href="#background-field-removal-panel">Background field removal panel</a></li>
<li><a class="reference internal" href="#qsm-panel">QSM panel</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../getting_started/Sepia-header.html"
                        title="previous chapter">SEPIA header</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Phase-unwrapping-standalone.html"
                        title="next chapter">Phase Unwarpping Standalone</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/gui/Sepia-One-stop-QSM-processing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Phase-unwrapping-standalone.html" title="Phase Unwarpping Standalone"
             >next</a> |</li>
        <li class="right" >
          <a href="../getting_started/Sepia-header.html" title="SEPIA header"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SEPIA 0.7 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Kwok-Shing Chan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>